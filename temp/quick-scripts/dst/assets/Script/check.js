
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/check.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a3721/aOY1GFrIWHHBzYGsi', 'check');
// Script/check.js

"use strict";

/**
 * @author uu
 * @file 检测组件
 */
cc.Class({
  "extends": cc.Component,
  properties: {
    groups: [],
    map: [],
    mapLength: 8
  },
  init: function init(g) {
    this._game = g;
    this.map = g.map;
    this.mapLength = g.rowNum;

    for (var i = 0; i < this.mapLength; i++) {
      //行
      this.groups[i] = [];

      for (var j = 0; j < this.mapLength; j++) {
        //列
        // this.map[i][j].getComponent('cell').growInit() //全部初始化
        if (!this.map[i][j]) {//    cc.log('报错x,y:', i, j)
        }

        this.map[i][j].getComponent('cell').isSingle = false;
        this.map[i][j].getComponent('cell').warningInit();
        this.groups[i][j] = [];
      }
    }
  },
  check: function check(g) {
    //该函数主要用于检测一个区块能否形成道具等
    var propConfig = g._controller.config.json.propConfig;
    this._game = g;
    this.map = g.map;
    this.mapLength = g.rowNum;
    var min = 999;

    for (var i = 0; i < propConfig.length; i++) {
      min = propConfig[i].min < min ? propConfig[i].min : min;
    }

    for (var _i = 0; _i < this.mapLength; _i++) {
      //行
      for (var j = 0; j < this.mapLength; j++) {
        //列
        this.pushPop(this.map[_i][j], _i, j);
        var target = this.map[_i][j];
        var x = target.getComponent('cell').iid;
        var y = target.getComponent('cell').jid;
        var isSingle = true;

        if (x - 1 >= 0 && this.map[x - 1][y].getComponent('cell').color == target.getComponent('cell').color) {
          isSingle = false;
        }

        if (x + 1 < this.mapLength && this.map[x + 1][y].getComponent('cell').color == target.getComponent('cell').color) {
          isSingle = false;
        }

        if (y - 1 >= 0 && this.map[x][y - 1].getComponent('cell').color == target.getComponent('cell').color) {
          isSingle = false;
        }

        if (y + 1 < this.mapLength && this.map[x][y + 1].getComponent('cell').color == target.getComponent('cell').color) {
          isSingle = false;
        }

        this.map[_i][j].getComponent('cell').isSingle = isSingle; // console.log(i, j, this.map[i][j].getComponent('cell').isSingle, this.map[i][j].getComponent('cell').color)

        if (this.groups[_i][j].length >= min) {
          for (var z = 0; z < propConfig.length; z++) {
            if (this.groups[_i][j].length <= propConfig[z].max && this.groups[_i][j].length >= propConfig[z].min) {
              this.warning(propConfig[z].type, this.groups[_i][j]);
            }
          }
        }
      }
    }
  },
  pushPop: function pushPop(target, i, j) {
    //用于判断一个方块四个方向上的方块颜色是否一样 如果一样则加入组 如果组长度小于1则返回false?
    // if (target.getComponent('cell').isPush==true) {
    //   return
    // }
    target.getComponent('cell').isPush = true;
    this.groups[i][j].push(target);
    var x = target.getComponent('cell').iid;
    var y = target.getComponent('cell').jid;

    if (x - 1 >= 0) {
      if (!this.map[x - 1][y].getComponent('cell').isPush && this.map[x - 1][y].getComponent('cell').color == target.getComponent('cell').color) {
        this.pushPop(this.map[x - 1][y], i, j);
      }
    }

    if (x + 1 < this.mapLength) {
      if (!this.map[x + 1][y].getComponent('cell').isPush && this.map[x + 1][y].getComponent('cell').color == target.getComponent('cell').color) {
        this.pushPop(this.map[x + 1][y], i, j);
      }
    }

    if (y - 1 >= 0) {
      if (!this.map[x][y - 1].getComponent('cell').isPush && this.map[x][y - 1].getComponent('cell').color == target.getComponent('cell').color) {
        this.pushPop(this.map[x][y - 1], i, j);
      }
    }

    if (y + 1 < this.mapLength) {
      if (!this.map[x][y + 1].getComponent('cell').isPush && this.map[x][y + 1].getComponent('cell').color == target.getComponent('cell').color) {
        this.pushPop(this.map[x][y + 1], i, j);
      }
    } // 判断方块是否单身

  },
  warning: function warning(type, group) {
    group.map(function (item) {
      item.getComponent('cell').onWarning(type);
    });
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxjaGVjay5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImdyb3VwcyIsIm1hcCIsIm1hcExlbmd0aCIsImluaXQiLCJnIiwiX2dhbWUiLCJyb3dOdW0iLCJpIiwiaiIsImdldENvbXBvbmVudCIsImlzU2luZ2xlIiwid2FybmluZ0luaXQiLCJjaGVjayIsInByb3BDb25maWciLCJfY29udHJvbGxlciIsImNvbmZpZyIsImpzb24iLCJtaW4iLCJsZW5ndGgiLCJwdXNoUG9wIiwidGFyZ2V0IiwieCIsImlpZCIsInkiLCJqaWQiLCJjb2xvciIsInoiLCJtYXgiLCJ3YXJuaW5nIiwidHlwZSIsImlzUHVzaCIsInB1c2giLCJncm91cCIsIml0ZW0iLCJvbldhcm5pbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQUEsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDUCxhQUFTRCxFQUFFLENBQUNFLFNBREw7QUFFUEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1ZDLElBQUFBLE1BQU0sRUFBRSxFQURFO0FBRVZDLElBQUFBLEdBQUcsRUFBRSxFQUZLO0FBR1ZDLElBQUFBLFNBQVMsRUFBRTtBQUhELEdBRkw7QUFPUEMsRUFBQUEsSUFQTyxnQkFPRkMsQ0FQRSxFQU9DO0FBQ04sU0FBS0MsS0FBTCxHQUFhRCxDQUFiO0FBQ0EsU0FBS0gsR0FBTCxHQUFXRyxDQUFDLENBQUNILEdBQWI7QUFDQSxTQUFLQyxTQUFMLEdBQWlCRSxDQUFDLENBQUNFLE1BQW5COztBQUNBLFNBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRyxLQUFLTCxTQUF6QixFQUFvQ0ssQ0FBQyxFQUFyQyxFQUF5QztBQUFFO0FBQ3pDLFdBQUtQLE1BQUwsQ0FBWU8sQ0FBWixJQUFpQixFQUFqQjs7QUFDQSxXQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUcsS0FBS04sU0FBekIsRUFBb0NNLENBQUMsRUFBckMsRUFBeUM7QUFBRTtBQUN6QztBQUNBLFlBQUksQ0FBQyxLQUFLUCxHQUFMLENBQVNNLENBQVQsRUFBWUMsQ0FBWixDQUFMLEVBQXFCLENBQ25CO0FBQ0Q7O0FBQ0QsYUFBS1AsR0FBTCxDQUFTTSxDQUFULEVBQVlDLENBQVosRUFBZUMsWUFBZixDQUE0QixNQUE1QixFQUFvQ0MsUUFBcEMsR0FBK0MsS0FBL0M7QUFDQSxhQUFLVCxHQUFMLENBQVNNLENBQVQsRUFBWUMsQ0FBWixFQUFlQyxZQUFmLENBQTRCLE1BQTVCLEVBQW9DRSxXQUFwQztBQUNBLGFBQUtYLE1BQUwsQ0FBWU8sQ0FBWixFQUFlQyxDQUFmLElBQW9CLEVBQXBCO0FBQ0Q7QUFDRjtBQUNGLEdBdkJNO0FBd0JQSSxFQUFBQSxLQXhCTyxpQkF3QkRSLENBeEJDLEVBd0JFO0FBQUU7QUFDVCxRQUFJUyxVQUFVLEdBQUdULENBQUMsQ0FBQ1UsV0FBRixDQUFjQyxNQUFkLENBQXFCQyxJQUFyQixDQUEwQkgsVUFBM0M7QUFDQSxTQUFLUixLQUFMLEdBQWFELENBQWI7QUFDQSxTQUFLSCxHQUFMLEdBQVdHLENBQUMsQ0FBQ0gsR0FBYjtBQUNBLFNBQUtDLFNBQUwsR0FBaUJFLENBQUMsQ0FBQ0UsTUFBbkI7QUFDQSxRQUFJVyxHQUFHLEdBQUcsR0FBVjs7QUFDQSxTQUFLLElBQUlWLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdNLFVBQVUsQ0FBQ0ssTUFBL0IsRUFBdUNYLENBQUMsRUFBeEMsRUFBNEM7QUFDMUNVLE1BQUFBLEdBQUcsR0FBR0osVUFBVSxDQUFDTixDQUFELENBQVYsQ0FBY1UsR0FBZCxHQUFvQkEsR0FBcEIsR0FBMEJKLFVBQVUsQ0FBQ04sQ0FBRCxDQUFWLENBQWNVLEdBQXhDLEdBQThDQSxHQUFwRDtBQUNEOztBQUNELFNBQUssSUFBSVYsRUFBQyxHQUFHLENBQWIsRUFBZ0JBLEVBQUMsR0FBRyxLQUFLTCxTQUF6QixFQUFvQ0ssRUFBQyxFQUFyQyxFQUF5QztBQUFFO0FBQ3pDLFdBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBRyxLQUFLTixTQUF6QixFQUFvQ00sQ0FBQyxFQUFyQyxFQUF5QztBQUFFO0FBQ3pDLGFBQUtXLE9BQUwsQ0FBYSxLQUFLbEIsR0FBTCxDQUFTTSxFQUFULEVBQVlDLENBQVosQ0FBYixFQUE2QkQsRUFBN0IsRUFBZ0NDLENBQWhDO0FBQ0EsWUFBSVksTUFBTSxHQUFHLEtBQUtuQixHQUFMLENBQVNNLEVBQVQsRUFBWUMsQ0FBWixDQUFiO0FBQ0EsWUFBSWEsQ0FBQyxHQUFHRCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJhLEdBQXBDO0FBQ0EsWUFBSUMsQ0FBQyxHQUFHSCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJlLEdBQXBDO0FBQ0EsWUFBSWQsUUFBUSxHQUFHLElBQWY7O0FBQ0EsWUFBS1csQ0FBQyxHQUFHLENBQUwsSUFBVyxDQUFYLElBQWdCLEtBQUtwQixHQUFMLENBQVNvQixDQUFDLEdBQUcsQ0FBYixFQUFnQkUsQ0FBaEIsRUFBbUJkLFlBQW5CLENBQWdDLE1BQWhDLEVBQXdDZ0IsS0FBeEMsSUFBaURMLE1BQU0sQ0FBQ1gsWUFBUCxDQUFvQixNQUFwQixFQUE0QmdCLEtBQWpHLEVBQXdHO0FBQ3RHZixVQUFBQSxRQUFRLEdBQUcsS0FBWDtBQUNEOztBQUNELFlBQUtXLENBQUMsR0FBRyxDQUFMLEdBQVUsS0FBS25CLFNBQWYsSUFBNEIsS0FBS0QsR0FBTCxDQUFTb0IsQ0FBQyxHQUFHLENBQWIsRUFBZ0JFLENBQWhCLEVBQW1CZCxZQUFuQixDQUFnQyxNQUFoQyxFQUF3Q2dCLEtBQXhDLElBQWlETCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJnQixLQUE3RyxFQUFvSDtBQUNsSGYsVUFBQUEsUUFBUSxHQUFHLEtBQVg7QUFDRDs7QUFFRCxZQUFLYSxDQUFDLEdBQUcsQ0FBTCxJQUFXLENBQVgsSUFBZ0IsS0FBS3RCLEdBQUwsQ0FBU29CLENBQVQsRUFBWUUsQ0FBQyxHQUFHLENBQWhCLEVBQW1CZCxZQUFuQixDQUFnQyxNQUFoQyxFQUF3Q2dCLEtBQXhDLElBQWlETCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJnQixLQUFqRyxFQUF3RztBQUN0R2YsVUFBQUEsUUFBUSxHQUFHLEtBQVg7QUFDRDs7QUFDRCxZQUFLYSxDQUFDLEdBQUcsQ0FBTCxHQUFVLEtBQUtyQixTQUFmLElBQTRCLEtBQUtELEdBQUwsQ0FBU29CLENBQVQsRUFBWUUsQ0FBQyxHQUFHLENBQWhCLEVBQW1CZCxZQUFuQixDQUFnQyxNQUFoQyxFQUF3Q2dCLEtBQXhDLElBQWlETCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJnQixLQUE3RyxFQUFvSDtBQUNsSGYsVUFBQUEsUUFBUSxHQUFHLEtBQVg7QUFDRDs7QUFDRCxhQUFLVCxHQUFMLENBQVNNLEVBQVQsRUFBWUMsQ0FBWixFQUFlQyxZQUFmLENBQTRCLE1BQTVCLEVBQW9DQyxRQUFwQyxHQUErQ0EsUUFBL0MsQ0FuQnVDLENBb0J4Qzs7QUFDQyxZQUFJLEtBQUtWLE1BQUwsQ0FBWU8sRUFBWixFQUFlQyxDQUFmLEVBQWtCVSxNQUFsQixJQUE0QkQsR0FBaEMsRUFBcUM7QUFDbkMsZUFBSyxJQUFJUyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHYixVQUFVLENBQUNLLE1BQS9CLEVBQXVDUSxDQUFDLEVBQXhDLEVBQTRDO0FBQzFDLGdCQUFJLEtBQUsxQixNQUFMLENBQVlPLEVBQVosRUFBZUMsQ0FBZixFQUFrQlUsTUFBbEIsSUFBNEJMLFVBQVUsQ0FBQ2EsQ0FBRCxDQUFWLENBQWNDLEdBQTFDLElBQWlELEtBQUszQixNQUFMLENBQVlPLEVBQVosRUFBZUMsQ0FBZixFQUFrQlUsTUFBbEIsSUFBNEJMLFVBQVUsQ0FBQ2EsQ0FBRCxDQUFWLENBQWNULEdBQS9GLEVBQW9HO0FBQ2xHLG1CQUFLVyxPQUFMLENBQWFmLFVBQVUsQ0FBQ2EsQ0FBRCxDQUFWLENBQWNHLElBQTNCLEVBQWlDLEtBQUs3QixNQUFMLENBQVlPLEVBQVosRUFBZUMsQ0FBZixDQUFqQztBQUNEO0FBQ0Y7QUFDRjtBQUNGO0FBQ0Y7QUFDRixHQWhFTTtBQWlFUFcsRUFBQUEsT0FqRU8sbUJBaUVDQyxNQWpFRCxFQWlFU2IsQ0FqRVQsRUFpRVlDLENBakVaLEVBaUVlO0FBQUU7QUFDdEI7QUFDQTtBQUNBO0FBQ0FZLElBQUFBLE1BQU0sQ0FBQ1gsWUFBUCxDQUFvQixNQUFwQixFQUE0QnFCLE1BQTVCLEdBQXFDLElBQXJDO0FBQ0EsU0FBSzlCLE1BQUwsQ0FBWU8sQ0FBWixFQUFlQyxDQUFmLEVBQWtCdUIsSUFBbEIsQ0FBdUJYLE1BQXZCO0FBQ0EsUUFBSUMsQ0FBQyxHQUFHRCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJhLEdBQXBDO0FBQ0EsUUFBSUMsQ0FBQyxHQUFHSCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJlLEdBQXBDOztBQUNBLFFBQUtILENBQUMsR0FBRyxDQUFMLElBQVcsQ0FBZixFQUFrQjtBQUNoQixVQUFJLENBQUMsS0FBS3BCLEdBQUwsQ0FBU29CLENBQUMsR0FBRyxDQUFiLEVBQWdCRSxDQUFoQixFQUFtQmQsWUFBbkIsQ0FBZ0MsTUFBaEMsRUFBd0NxQixNQUF6QyxJQUFtRCxLQUFLN0IsR0FBTCxDQUFTb0IsQ0FBQyxHQUFHLENBQWIsRUFBZ0JFLENBQWhCLEVBQW1CZCxZQUFuQixDQUFnQyxNQUFoQyxFQUF3Q2dCLEtBQXhDLElBQWlETCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJnQixLQUFwSSxFQUEySTtBQUN6SSxhQUFLTixPQUFMLENBQWEsS0FBS2xCLEdBQUwsQ0FBU29CLENBQUMsR0FBRyxDQUFiLEVBQWdCRSxDQUFoQixDQUFiLEVBQWlDaEIsQ0FBakMsRUFBb0NDLENBQXBDO0FBQ0Q7QUFDRjs7QUFDRCxRQUFLYSxDQUFDLEdBQUcsQ0FBTCxHQUFVLEtBQUtuQixTQUFuQixFQUE4QjtBQUM1QixVQUFJLENBQUMsS0FBS0QsR0FBTCxDQUFTb0IsQ0FBQyxHQUFHLENBQWIsRUFBZ0JFLENBQWhCLEVBQW1CZCxZQUFuQixDQUFnQyxNQUFoQyxFQUF3Q3FCLE1BQXpDLElBQW1ELEtBQUs3QixHQUFMLENBQVNvQixDQUFDLEdBQUcsQ0FBYixFQUFnQkUsQ0FBaEIsRUFBbUJkLFlBQW5CLENBQWdDLE1BQWhDLEVBQXdDZ0IsS0FBeEMsSUFBaURMLE1BQU0sQ0FBQ1gsWUFBUCxDQUFvQixNQUFwQixFQUE0QmdCLEtBQXBJLEVBQTJJO0FBQ3pJLGFBQUtOLE9BQUwsQ0FBYSxLQUFLbEIsR0FBTCxDQUFTb0IsQ0FBQyxHQUFHLENBQWIsRUFBZ0JFLENBQWhCLENBQWIsRUFBaUNoQixDQUFqQyxFQUFvQ0MsQ0FBcEM7QUFDRDtBQUNGOztBQUNELFFBQUtlLENBQUMsR0FBRyxDQUFMLElBQVcsQ0FBZixFQUFrQjtBQUNoQixVQUFJLENBQUMsS0FBS3RCLEdBQUwsQ0FBU29CLENBQVQsRUFBWUUsQ0FBQyxHQUFHLENBQWhCLEVBQW1CZCxZQUFuQixDQUFnQyxNQUFoQyxFQUF3Q3FCLE1BQXpDLElBQW1ELEtBQUs3QixHQUFMLENBQVNvQixDQUFULEVBQVlFLENBQUMsR0FBRyxDQUFoQixFQUFtQmQsWUFBbkIsQ0FBZ0MsTUFBaEMsRUFBd0NnQixLQUF4QyxJQUFpREwsTUFBTSxDQUFDWCxZQUFQLENBQW9CLE1BQXBCLEVBQTRCZ0IsS0FBcEksRUFBMkk7QUFDekksYUFBS04sT0FBTCxDQUFhLEtBQUtsQixHQUFMLENBQVNvQixDQUFULEVBQVlFLENBQUMsR0FBRyxDQUFoQixDQUFiLEVBQWlDaEIsQ0FBakMsRUFBb0NDLENBQXBDO0FBQ0Q7QUFDRjs7QUFDRCxRQUFLZSxDQUFDLEdBQUcsQ0FBTCxHQUFVLEtBQUtyQixTQUFuQixFQUE4QjtBQUM1QixVQUFJLENBQUMsS0FBS0QsR0FBTCxDQUFTb0IsQ0FBVCxFQUFZRSxDQUFDLEdBQUcsQ0FBaEIsRUFBbUJkLFlBQW5CLENBQWdDLE1BQWhDLEVBQXdDcUIsTUFBekMsSUFBbUQsS0FBSzdCLEdBQUwsQ0FBU29CLENBQVQsRUFBWUUsQ0FBQyxHQUFHLENBQWhCLEVBQW1CZCxZQUFuQixDQUFnQyxNQUFoQyxFQUF3Q2dCLEtBQXhDLElBQWlETCxNQUFNLENBQUNYLFlBQVAsQ0FBb0IsTUFBcEIsRUFBNEJnQixLQUFwSSxFQUEySTtBQUN6SSxhQUFLTixPQUFMLENBQWEsS0FBS2xCLEdBQUwsQ0FBU29CLENBQVQsRUFBWUUsQ0FBQyxHQUFHLENBQWhCLENBQWIsRUFBaUNoQixDQUFqQyxFQUFvQ0MsQ0FBcEM7QUFDRDtBQUNGLEtBM0JtQixDQTZCcEI7O0FBRUQsR0FoR007QUFpR1BvQixFQUFBQSxPQWpHTyxtQkFpR0NDLElBakdELEVBaUdPRyxLQWpHUCxFQWlHYztBQUNuQkEsSUFBQUEsS0FBSyxDQUFDL0IsR0FBTixDQUFVLFVBQUFnQyxJQUFJLEVBQUk7QUFDaEJBLE1BQUFBLElBQUksQ0FBQ3hCLFlBQUwsQ0FBa0IsTUFBbEIsRUFBMEJ5QixTQUExQixDQUFvQ0wsSUFBcEM7QUFDRCxLQUZEO0FBR0Q7QUFyR00sQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAYXV0aG9yIHV1XG4gKiBAZmlsZSDmo4DmtYvnu4Tku7ZcbiAqL1xuY2MuQ2xhc3Moe1xuICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG4gIHByb3BlcnRpZXM6IHtcbiAgICBncm91cHM6IFtdLFxuICAgIG1hcDogW10sXG4gICAgbWFwTGVuZ3RoOiA4XG4gIH0sXG4gIGluaXQoZykge1xuICAgIHRoaXMuX2dhbWUgPSBnXG4gICAgdGhpcy5tYXAgPSBnLm1hcFxuICAgIHRoaXMubWFwTGVuZ3RoID0gZy5yb3dOdW1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubWFwTGVuZ3RoOyBpKyspIHsgLy/ooYxcbiAgICAgIHRoaXMuZ3JvdXBzW2ldID0gW11cbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5tYXBMZW5ndGg7IGorKykgeyAvL+WIl1xuICAgICAgICAvLyB0aGlzLm1hcFtpXVtqXS5nZXRDb21wb25lbnQoJ2NlbGwnKS5ncm93SW5pdCgpIC8v5YWo6YOo5Yid5aeL5YyWXG4gICAgICAgIGlmICghdGhpcy5tYXBbaV1bal0pIHtcbiAgICAgICAgICAvLyAgICBjYy5sb2coJ+aKpemUmXgseTonLCBpLCBqKVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubWFwW2ldW2pdLmdldENvbXBvbmVudCgnY2VsbCcpLmlzU2luZ2xlID0gZmFsc2VcbiAgICAgICAgdGhpcy5tYXBbaV1bal0uZ2V0Q29tcG9uZW50KCdjZWxsJykud2FybmluZ0luaXQoKVxuICAgICAgICB0aGlzLmdyb3Vwc1tpXVtqXSA9IFtdXG4gICAgICB9XG4gICAgfVxuICB9LFxuICBjaGVjayhnKSB7IC8v6K+l5Ye95pWw5Li76KaB55So5LqO5qOA5rWL5LiA5Liq5Yy65Z2X6IO95ZCm5b2i5oiQ6YGT5YW3562JXG4gICAgbGV0IHByb3BDb25maWcgPSBnLl9jb250cm9sbGVyLmNvbmZpZy5qc29uLnByb3BDb25maWdcbiAgICB0aGlzLl9nYW1lID0gZ1xuICAgIHRoaXMubWFwID0gZy5tYXBcbiAgICB0aGlzLm1hcExlbmd0aCA9IGcucm93TnVtXG4gICAgbGV0IG1pbiA9IDk5OVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvcENvbmZpZy5sZW5ndGg7IGkrKykge1xuICAgICAgbWluID0gcHJvcENvbmZpZ1tpXS5taW4gPCBtaW4gPyBwcm9wQ29uZmlnW2ldLm1pbiA6IG1pblxuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubWFwTGVuZ3RoOyBpKyspIHsgLy/ooYxcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5tYXBMZW5ndGg7IGorKykgeyAvL+WIl1xuICAgICAgICB0aGlzLnB1c2hQb3AodGhpcy5tYXBbaV1bal0sIGksIGopXG4gICAgICAgIGxldCB0YXJnZXQgPSB0aGlzLm1hcFtpXVtqXVxuICAgICAgICBsZXQgeCA9IHRhcmdldC5nZXRDb21wb25lbnQoJ2NlbGwnKS5paWRcbiAgICAgICAgbGV0IHkgPSB0YXJnZXQuZ2V0Q29tcG9uZW50KCdjZWxsJykuamlkXG4gICAgICAgIGxldCBpc1NpbmdsZSA9IHRydWVcbiAgICAgICAgaWYgKCh4IC0gMSkgPj0gMCAmJiB0aGlzLm1hcFt4IC0gMV1beV0uZ2V0Q29tcG9uZW50KCdjZWxsJykuY29sb3IgPT0gdGFyZ2V0LmdldENvbXBvbmVudCgnY2VsbCcpLmNvbG9yKSB7XG4gICAgICAgICAgaXNTaW5nbGUgPSBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIGlmICgoeCArIDEpIDwgdGhpcy5tYXBMZW5ndGggJiYgdGhpcy5tYXBbeCArIDFdW3ldLmdldENvbXBvbmVudCgnY2VsbCcpLmNvbG9yID09IHRhcmdldC5nZXRDb21wb25lbnQoJ2NlbGwnKS5jb2xvcikge1xuICAgICAgICAgIGlzU2luZ2xlID0gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgoeSAtIDEpID49IDAgJiYgdGhpcy5tYXBbeF1beSAtIDFdLmdldENvbXBvbmVudCgnY2VsbCcpLmNvbG9yID09IHRhcmdldC5nZXRDb21wb25lbnQoJ2NlbGwnKS5jb2xvcikge1xuICAgICAgICAgIGlzU2luZ2xlID0gZmFsc2VcbiAgICAgICAgfVxuICAgICAgICBpZiAoKHkgKyAxKSA8IHRoaXMubWFwTGVuZ3RoICYmIHRoaXMubWFwW3hdW3kgKyAxXS5nZXRDb21wb25lbnQoJ2NlbGwnKS5jb2xvciA9PSB0YXJnZXQuZ2V0Q29tcG9uZW50KCdjZWxsJykuY29sb3IpIHtcbiAgICAgICAgICBpc1NpbmdsZSA9IGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tYXBbaV1bal0uZ2V0Q29tcG9uZW50KCdjZWxsJykuaXNTaW5nbGUgPSBpc1NpbmdsZVxuICAgICAgIC8vIGNvbnNvbGUubG9nKGksIGosIHRoaXMubWFwW2ldW2pdLmdldENvbXBvbmVudCgnY2VsbCcpLmlzU2luZ2xlLCB0aGlzLm1hcFtpXVtqXS5nZXRDb21wb25lbnQoJ2NlbGwnKS5jb2xvcilcbiAgICAgICAgaWYgKHRoaXMuZ3JvdXBzW2ldW2pdLmxlbmd0aCA+PSBtaW4pIHtcbiAgICAgICAgICBmb3IgKGxldCB6ID0gMDsgeiA8IHByb3BDb25maWcubGVuZ3RoOyB6KyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmdyb3Vwc1tpXVtqXS5sZW5ndGggPD0gcHJvcENvbmZpZ1t6XS5tYXggJiYgdGhpcy5ncm91cHNbaV1bal0ubGVuZ3RoID49IHByb3BDb25maWdbel0ubWluKSB7XG4gICAgICAgICAgICAgIHRoaXMud2FybmluZyhwcm9wQ29uZmlnW3pdLnR5cGUsIHRoaXMuZ3JvdXBzW2ldW2pdKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgcHVzaFBvcCh0YXJnZXQsIGksIGopIHsgLy/nlKjkuo7liKTmlq3kuIDkuKrmlrnlnZflm5vkuKrmlrnlkJHkuIrnmoTmlrnlnZfpopzoibLmmK/lkKbkuIDmoLcg5aaC5p6c5LiA5qC35YiZ5Yqg5YWl57uEIOWmguaenOe7hOmVv+W6puWwj+S6jjHliJnov5Tlm55mYWxzZT9cbiAgICAvLyBpZiAodGFyZ2V0LmdldENvbXBvbmVudCgnY2VsbCcpLmlzUHVzaD09dHJ1ZSkge1xuICAgIC8vICAgcmV0dXJuXG4gICAgLy8gfVxuICAgIHRhcmdldC5nZXRDb21wb25lbnQoJ2NlbGwnKS5pc1B1c2ggPSB0cnVlXG4gICAgdGhpcy5ncm91cHNbaV1bal0ucHVzaCh0YXJnZXQpXG4gICAgbGV0IHggPSB0YXJnZXQuZ2V0Q29tcG9uZW50KCdjZWxsJykuaWlkXG4gICAgbGV0IHkgPSB0YXJnZXQuZ2V0Q29tcG9uZW50KCdjZWxsJykuamlkXG4gICAgaWYgKCh4IC0gMSkgPj0gMCkge1xuICAgICAgaWYgKCF0aGlzLm1hcFt4IC0gMV1beV0uZ2V0Q29tcG9uZW50KCdjZWxsJykuaXNQdXNoICYmIHRoaXMubWFwW3ggLSAxXVt5XS5nZXRDb21wb25lbnQoJ2NlbGwnKS5jb2xvciA9PSB0YXJnZXQuZ2V0Q29tcG9uZW50KCdjZWxsJykuY29sb3IpIHtcbiAgICAgICAgdGhpcy5wdXNoUG9wKHRoaXMubWFwW3ggLSAxXVt5XSwgaSwgailcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCh4ICsgMSkgPCB0aGlzLm1hcExlbmd0aCkge1xuICAgICAgaWYgKCF0aGlzLm1hcFt4ICsgMV1beV0uZ2V0Q29tcG9uZW50KCdjZWxsJykuaXNQdXNoICYmIHRoaXMubWFwW3ggKyAxXVt5XS5nZXRDb21wb25lbnQoJ2NlbGwnKS5jb2xvciA9PSB0YXJnZXQuZ2V0Q29tcG9uZW50KCdjZWxsJykuY29sb3IpIHtcbiAgICAgICAgdGhpcy5wdXNoUG9wKHRoaXMubWFwW3ggKyAxXVt5XSwgaSwgailcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCh5IC0gMSkgPj0gMCkge1xuICAgICAgaWYgKCF0aGlzLm1hcFt4XVt5IC0gMV0uZ2V0Q29tcG9uZW50KCdjZWxsJykuaXNQdXNoICYmIHRoaXMubWFwW3hdW3kgLSAxXS5nZXRDb21wb25lbnQoJ2NlbGwnKS5jb2xvciA9PSB0YXJnZXQuZ2V0Q29tcG9uZW50KCdjZWxsJykuY29sb3IpIHtcbiAgICAgICAgdGhpcy5wdXNoUG9wKHRoaXMubWFwW3hdW3kgLSAxXSwgaSwgailcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCh5ICsgMSkgPCB0aGlzLm1hcExlbmd0aCkge1xuICAgICAgaWYgKCF0aGlzLm1hcFt4XVt5ICsgMV0uZ2V0Q29tcG9uZW50KCdjZWxsJykuaXNQdXNoICYmIHRoaXMubWFwW3hdW3kgKyAxXS5nZXRDb21wb25lbnQoJ2NlbGwnKS5jb2xvciA9PSB0YXJnZXQuZ2V0Q29tcG9uZW50KCdjZWxsJykuY29sb3IpIHtcbiAgICAgICAgdGhpcy5wdXNoUG9wKHRoaXMubWFwW3hdW3kgKyAxXSwgaSwgailcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyDliKTmlq3mlrnlnZfmmK/lkKbljZXouqtcblxuICB9LFxuICB3YXJuaW5nKHR5cGUsIGdyb3VwKSB7XG4gICAgZ3JvdXAubWFwKGl0ZW0gPT4ge1xuICAgICAgaXRlbS5nZXRDb21wb25lbnQoJ2NlbGwnKS5vbldhcm5pbmcodHlwZSlcbiAgICB9KVxuICB9XG59KTsiXX0=