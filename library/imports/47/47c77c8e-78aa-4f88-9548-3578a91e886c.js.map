{"version":3,"sources":["assets\\Script\\game.js"],"names":["AC","require","cc","Class","Component","properties","_status","blockPrefab","Prefab","blockSprite","SpriteFrame","warningSpriteFrame","propSpriteFrame","checkMgr","revivePage","Node","tutorialNode","shareBtn","shareSuccessDialog","luping","share","start","ks","console","log","_gameRecorder","bindNode","generatePool","loadRes","init","c","_controller","_score","scoreMgr","rowNum","config","json","gap","animationSpeed","blockWidth","reviveTimer","active","isWeChat","social","node","blocksContainer","getChildByName","gameStart","recoveryAllBlocks","then","sys","platform","WECHAT_GAME","hasShared","data","isFirstTime","mapSet","result","showTutorial","map","tutorialProgress","recorder","getGameRecorder","on","res","error","code","GameRecorder_StartWhileAlreadyStartRecording","JSON","stringify","GameRecorder_StopWhileNotStartRecording","showModal","title","content","showCancel","GameRecorder_RecordFailedTimeRangeTooShort","GameRecorder_RecordFailedTimeRangeTooLong","GameRecorder_RecordFailedNoVideo","_this2","videoID","success","dataRes","confirm","publishVideo","gameRecorderStart","startFlag","stop","path","loader","err","spriteFrame","getComponent","Sprite","video","callback","undefined","shareAppMessage","target","label","runAction","repeatForever","sequence","scaleTo","x","y","Label","string","closeTutorial","stopAllActions","onTouched","type","setTimeout","isFirst","wx","getStorageSync","setStorageSync","localStorage","getItem","setItem","onItemShare","onItemShareButton","fakeShareSuccess","onItemAdv","BYTEDANCE_GAME","onReviveButton","onCreateBomb","Math","floor","random","_itemType","changeItemType","num","Array","self","a","b","d","tutorialPos","Promise","resolve","reject","i","j","itemType","instantiateBlock","color","width","startTime","startAnimationTime","check","checkNeedFall","checkNeedFallTimer","clearTimeout","onFall","checkGenerateProp","chain","canFall","blockPool","put","playFallAction","k","gameOver","pageMgr","addPage","closeBannerAdv","askRevive","rangeSprite","fillRange","isRangeAction","numLabel","clearInterval","setInterval","onSkipRevive","showReviveSuccess","onReviveCertainBtn","removePage","onRevive","update","pages","onGameOver","restart","onOpenPage","onUserTouched","iid","jid","warning","pos","generatePropItem","onItem","tipBox","addMult","musicMgr","onDouble","distance","sqrt","pow","surfaceAction","shackAction","onShakePhone","isPropChain","onBoom","rockAction","onStep","onMagic","isSingle","NodePool","block","instantiate","parent","size","get","scale","children","length"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\n * @author uu\n * @file 游戏控制\n */\nvar AC = require('action')\ncc.Class({\n\textends: cc.Component,\n\tproperties: {\n\t\t_status: 0, //0 未开始 1 游戏开始 2 游戏暂停 3 游戏结束 4 下落状态 5无法触摸状态\n\t\tblockPrefab: cc.Prefab,\n\t\tblockSprite: [cc.SpriteFrame], //todo: 换成动态生成 暂不处理\n\t\twarningSpriteFrame: [cc.SpriteFrame],\n\t\tpropSpriteFrame: [cc.SpriteFrame],\n\t\tcheckMgr: require(\"check\"),\n\t\trevivePage: cc.Node,\n\t\ttutorialNode: cc.Node,\n\t\tshareBtn: cc.Node,\n\t\tshareSuccessDialog: cc.Node,\n\t\tluping: cc.Node,\n\t\tshare: cc.Node\n\t},\n\tstart() {\n\t\tif (typeof ks !== 'undefined'){\n\t\t\tconsole.log(\"创建录屏管理器\")\n\t\t\tthis._gameRecorder();\n\t\t}\n\t\tthis.bindNode()\n\t\tthis.generatePool()\n\t\tthis.loadRes()\n\t},\n\tloadRes() {\n\n\t},\n\tinit(c) {\n\t\tthis._controller = c\n\t\tthis._score = c.scoreMgr\n\t\tthis.rowNum = c.config.json.rowNum\n\t\tthis.gap = c.config.json.gap\n\t\tthis.animationSpeed = c.config.json.gap\n\t\tthis.blockWidth = (730 - (this.rowNum + 1) * this.gap) / this.rowNum\n\t\tthis.reviveTimer = null\n\t\tthis.tutorialNode.active = false\n\t\tthis.isWeChat = this._controller.social.node.active\n\t\tthis.shareSuccessDialog.active = false\n\t\t//console.log(this.gap)\n\t\t//console.log(this.blockWidth)\n\t},\n\t// 动态获取需要动态控制的组件\n\tbindNode() {\n\t\tthis.blocksContainer = this.node.getChildByName('map')\n\t},\n\t//---------------- 游戏控制 ---------------------\n\t// 游戏开始\n\tgameStart() {\n\t\tthis.recoveryAllBlocks().then()\n\t\tthis.shareBtn.active = true\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME) {\n\t\t\tthis._controller.social.hasShared = false\n\t\t}\n\t\tthis._score.init(this)\n\t\tlet data = [\n\t\t\t[1, 1, 1, 1, 1, 1, 1, 1],\n\t\t\t[1, 1, 1, 1, 1, 1, 1, 1],\n\t\t\t[4, 2, 3, 4, 2, 2, 3, 4]\n\t\t]\n\t\tif (this.isFirstTime()) {\n\t\t\tthis.mapSet(this.rowNum, data).then((result) => {\n\t\t\t\tthis.showTutorial(this.map[1][4], '点击连续的区域生成炸弹鸭')\n\t\t\t\tthis.tutorialProgress = 1\n\t\t\t\tthis._status = 1\n\t\t\t})\n\t\t} else {\n\t\t\tthis.mapSet(this.rowNum).then((result) => {\n\t\t\t\tthis._status = 1\n\t\t\t})\n\t\t}\n\t},\n\t_gameRecorder(){\n\t\tif (typeof ks !== 'undefined'){\n\t\t\t// 可以监听 error 事件\n\t\t\tif (this.recorder){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.recorder = ks.getGameRecorder()\n\t\t\tthis.recorder.on('start', res => {\n\t\t\t\tconsole.log(\"开始录屏\");\n\t\t\t})\n\t\t\tthis.recorder.on('error', res => {\n\t\t\t\tconst error = res.error\n\t\t\t\tif (error.code === ks.error.GameRecorder_StartWhileAlreadyStartRecording) {\n\n\t\t\t\t}\n\t\t\t})\n\t\t\tthis.recorder.on(\"stop\", res => {\n\t\t\t\tconsole.log(\"暂停录屏返参结果:\",JSON.stringify(res))\n\t\t\t\tif(res.error){\n\t\t\t\t\tif (res.error.code === ks.error.GameRecorder_StopWhileNotStartRecording) {\n\t\t\t\t\t\tks.showModal({\n\t\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\t\tcontent: '在还没有开始录制的情况下调用 stop',\n\t\t\t\t\t\t\tshowCancel: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (res.error.code === ks.error.GameRecorder_RecordFailedTimeRangeTooShort) {\n\t\t\t\t\t\tks.showModal({\n\t\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\t\tcontent: '录制结束，录制时间太短',\n\t\t\t\t\t\t\tshowCancel: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (res.error.code === ks.error.GameRecorder_RecordFailedTimeRangeTooLong) {\n\t\t\t\t\t\tks.showModal({\n\t\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\t\tcontent: '录制结束，录制时间太长',\n\t\t\t\t\t\t\tshowCancel: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (res.error.code === ks.error.GameRecorder_RecordFailedNoVideo) {\n\t\t\t\t\t\tks.showModal({\n\t\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\t\tcontent: '录制结束，未录制到视频',\n\t\t\t\t\t\t\tshowCancel: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}else {\n\t\t\t\t\tlet _this2 = this;\n\t\t\t\t\tif (res.videoID){\n\t\t\t\t\t\tconsole.log(\"提示发布视频:\", res.videoID)\n\t\t\t\t\t\tks.showModal({\n\t\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\t\tcontent: '发布录屏到快手',\n\t\t\t\t\t\t\tsuccess(dataRes){\n\t\t\t\t\t\t\t\tif (dataRes.confirm){\n\t\t\t\t\t\t\t\t\t_this2.publishVideo(res.videoID);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t})\n\t\t\tthis.recorder.on('abort', res => {\n\t\t\t\tconsole.log(\"放弃录制游戏画面。此时已经录制的内容会被丢弃。\")\n\t\t\t})\n\t\t}\n\t},\n\n\tgameRecorderStart(){\n\t\tif (this.recorder){\n\t\t\tconsole.log(\"录屏管理器已创建\")\n\t\t\tif (this.startFlag === 1){\n\t\t\t\tthis.recorder.stop();\n\t\t\t\tthis.startFlag = 0;\n\t\t\t}else {\n\t\t\t\tthis.recorder.start();\n\t\t\t\tthis.startFlag = 1;\n\t\t\t}\n\t\t\tlet path = '/atlas/screenRecording-' + this.startFlag;\n\t\t\tconsole.log(\"录屏图标切换路径:\",path)\n\t\t\tlet _this2 = this;\n\t\t\tcc.loader.loadRes(path, cc.SpriteFrame, function (err, spriteFrame){\n\t\t\t\tif (err){\n\t\t\t\t\tconsole.error('set sprite frame failed! err', path, err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t_this2.luping.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\n\t\t\t})\n\t\t}\n\n\t},\n\n\tpublishVideo(videoID){\n\t\tif (this.recorder){\n\t\t\tthis.recorder.publishVideo({\n\t\t\t\tvideo: videoID,\n\t\t\t\tcallback: (error) => {\n\t\t\t\t\tif (error != null && error != undefined) {\n\t\t\t\t\t\tconsole.log(\"分布录屏失败: \" , error);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\"分布录屏成功\");\n\t\t\t\t}\n\t\t\t});\n\t\t}else {\n\t\t\tks.showModal({\n\t\t\t\ttitle: '提示',\n\t\t\t\tcontent: '录屏发布失败',\n\t\t\t\tshowCancel: false\n\t\t\t});\n\t\t}\n\n\t},\n\n\tshareAppMessage(){\n\t\tks.shareAppMessage({})\n\t},\n\n\n\n\tshowTutorial(target, label) {\n\t\tthis.tutorialNode.active = true\n\t\tthis.tutorialNode.getChildByName('targetBtn').getChildByName('sqr').runAction(cc.repeatForever(cc.sequence(cc.scaleTo(0.3, 0.8), cc.scaleTo(0.3, 1.2))))\n\t\tthis.tutorialNode.getChildByName('target').x = target.x\n\t\tthis.tutorialNode.getChildByName('target').y = target.y\n\t\tthis.tutorialNode.getChildByName('targetBtn').x = target.x\n\t\tthis.tutorialNode.getChildByName('targetBtn').y = target.y\n\t\tthis.tutorialNode.getChildByName('label').getChildByName('label').getComponent(cc.Label).string = label\n\t},\n\tcloseTutorial() {\n\t\tthis.tutorialNode.getChildByName('targetBtn').getChildByName('sqr').stopAllActions()\n\t\t// console.log('close Tutorial ')\n\t\tthis.tutorialNode.active = false\n\t\tthis._status = 1\n\n\t\tthis.map[1][4].getComponent('cell').onTouched({\n\t\t\ttype: 1\n\t\t}, false, false)\n\t\tif (this.tutorialProgress == 1) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.showTutorial(this.map[1][4], '点击炸弹消除所有同色方块哦')\n\t\t\t\tthis.tutorialProgress = 2\n\t\t\t}, 1000)\n\t\t}\n\t},\n\tisFirstTime() {\n\t\tlet isFirst = false\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME && !wx.getStorageSync('isFirst')) {\n\t\t\twx.setStorageSync('isFirst', \"1\")\n\t\t\tisFirst = true\n\t\t} else if (!cc.sys.localStorage.getItem('isFirst')) {\n\t\t\tcc.sys.localStorage.setItem('isFirst', \"1\")\n\t\t\tisFirst = true\n\t\t}\n\t\treturn isFirst\n\t},\n\tonItemShare() {\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME) {\n\t\t\tthis._controller.social.onItemShareButton()\n\t\t} else {\n\t\t\tthis.fakeShareSuccess()\n\t\t}\n\t},\n\tonItemAdv() {\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME || cc.sys.platform === cc.sys.BYTEDANCE_GAME) {\n\t\t\tthis._controller.social.onReviveButton(2)\n\t\t} else {\n\t\t\tthis.fakeShareSuccess()\n\t\t}\n\t},\n\tfakeShareSuccess() {\n\t\tthis.shareBtn.active = false\n\t\tthis.shareSuccessDialog.active = true\n\t},\n\tonCreateBomb() {\n\t\tlet x = Math.floor(Math.random() * 8)\n\t\tlet y = Math.floor(Math.random() * 8)\n\t\tthis.shareSuccessDialog.active = false\n\t\tif(this.map[x][y].getComponent('cell')._itemType==0){\n\t\t\tthis.map[x][y].getComponent('cell').changeItemType(2)\n\t\t}else{\n\t\t\tthis.onCreateBomb()\n\t\t\treturn\n\t\t}\n\t},\n\t/**\n\t * 初始化地图\n\t * @param {*} num \n\t * @param {*} data 传入颜色数组\n\t */\n\tmapSet(num, data) {\n\t\tthis.map = new Array()\n\t\tlet self = this\n\t\t// 生成两个随机的对象数组\n\t\tlet a = Math.floor(Math.random() * num)\n\t\tlet b = Math.floor(Math.random() * num)\n\n\t\tlet c = Math.floor(1 + Math.random() * (num - 1)) - 1\n\t\ta == c ? c++ : ''\n\t\tlet d = Math.floor(Math.random() * num)\n\t\tthis.tutorialPos = [c, d]\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tfor (let i = 0; i < num; i++) { //行\n\t\t\t\tthis.map[i] = new Array()\n\t\t\t\tfor (let j = 0; j < num; j++) { //列\n\t\t\t\t\tlet itemType = (i == a && j == b) ? 1 : (i == c && j == d) ? (data ? 1 : 2) : 0\n\t\t\t\t\tself.map[i][j] = self.instantiateBlock(self, {\n\t\t\t\t\t\tx: j,\n\t\t\t\t\t\ty: i,\n\t\t\t\t\t\tcolor: (data && data[i]) ? data[i][j] : null,\n\t\t\t\t\t\twidth: self.blockWidth,\n\t\t\t\t\t\tstartTime: (i + j + 1) * self._controller.config.json.startAnimationTime / num * 2\n\t\t\t\t\t}, self.blocksContainer, itemType)\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.checkMgr.init(this)\n\t\t\tsetTimeout(() => {\n\t\t\t\t\tresolve('200 OK');\n\t\t\t\t\tthis.checkMgr.check(this)\n\t\t\t\t}, self._controller.config.json.startAnimationTime * num / 2 / 1\n\t\t\t\t//  (cc.game.getFrameRate() / 60)\n\t\t\t)\n\t\t})\n\t},\n\t//防抖动 判断是否需要检测下落\n\tcheckNeedFall() {\n\t\tif (this.checkNeedFallTimer) {\n\t\t\tclearTimeout(this.checkNeedFallTimer)\n\t\t}\n\t\tthis.checkNeedFallTimer = setTimeout(() => {\n\t\t\t\tif (this._status == 5) {\n\t\t\t\t\tthis._status = 4\n\t\t\t\t\tthis.onFall()\n\t\t\t\t}\n\t\t\t}, 300 / 1\n\t\t\t// (cc.game.getFrameRate() / 60)\n\t\t)\n\t},\n\t//方块下落\n\tonFall() {\n\t\tthis.checkGenerateProp(this._score.chain).then(() => {\n\t\t\tlet self = this\n\t\t\tlet canFall = 0\n\t\t\t//从每一列的最下面一个开始往上判断\n\t\t\t//如果有空 就判断有几个空 然后让最上方的方块掉落下来\n\t\t\tfor (let j = this.rowNum - 1; j >= 0; j--) {\n\t\t\t\tcanFall = 0\n\t\t\t\tfor (let i = this.rowNum - 1; i >= 0; i--) {\n\t\t\t\t\tif (this.map[i][j].getComponent('cell')._status == 2) {\n\t\t\t\t\t\tthis.blockPool.put(this.map[i][j])\n\t\t\t\t\t\tthis.map[i][j] = null\n\t\t\t\t\t\tcanFall++\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (canFall != 0) {\n\t\t\t\t\t\t\tthis.map[i + canFall][j] = this.map[i][j]\n\t\t\t\t\t\t\tthis.map[i][j] = null\n\t\t\t\t\t\t\tthis.map[i + canFall][j].getComponent('cell').playFallAction(canFall, {\n\t\t\t\t\t\t\t\tx: j,\n\t\t\t\t\t\t\t\ty: i + canFall,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var k = 0; k < canFall; k++) {\n\t\t\t\t\tthis.map[k][j] = this.instantiateBlock(this, {\n\t\t\t\t\t\tx: j,\n\t\t\t\t\t\ty: k,\n\t\t\t\t\t\twidth: this.blockWidth,\n\t\t\t\t\t\tstartTime: null\n\t\t\t\t\t}, this.blocksContainer, '', {\n\t\t\t\t\t\tx: j,\n\t\t\t\t\t\ty: -canFall + k\n\t\t\t\t\t})\n\t\t\t\t\tthis.map[k][j].getComponent('cell').playFallAction(canFall, null)\n\t\t\t\t}\n\t\t\t}\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.checkMgr.init(this)\n\t\t\t\tthis.checkMgr.check(this)\n\t\t\t\tthis._status = 1\n\t\t\t}, 250)\n\t\t})\n\t},\n\tgameOver() {\n\t\tthis._status = 3\n\t\tthis._controller.pageMgr.addPage(2)\n\t\tthis._controller.pageMgr.addPage(4)\n\t\tif (this._controller.social.node.active) {\n\t\t\tthis._controller.social.closeBannerAdv()\n\t\t}\n\t},\n\t// todo 复活\n\taskRevive() {\n\t\tthis._controller.pageMgr.addPage(2)\n\t\tthis._controller.pageMgr.addPage(5)\n\t\tthis.revivePage.active = true\n\t\tthis.revivePage.getChildByName('askRevive').active = true\n\t\tthis.revivePage.getChildByName('successRevive').active = false\n\t\tthis.rangeSprite = this.revivePage.getChildByName('askRevive').getChildByName('numBg').getChildByName('sprite').getComponent(cc.Sprite)\n\t\tthis.rangeSprite.fillRange = 1\n\t\tthis.isRangeAction = true\n\t\tlet numLabel = this.revivePage.getChildByName('askRevive').getChildByName('numBg').getChildByName('num').getComponent(cc.Label)\n\t\tnumLabel.string = 9\n\t\tif (this.reviveTimer) {\n\t\t\tclearInterval(this.reviveTimer)\n\t\t}\n\t\tthis.reviveTimer = setInterval(() => {\n\t\t\tif (+numLabel.string > 0) {\n\t\t\t\tnumLabel.string--\n\t\t\t\tthis.rangeSprite.fillRange = 1\n\t\t\t} else {\n\t\t\t\tthis.onSkipRevive()\n\t\t\t}\n\t\t}, 1000)\n\n\t},\n\tonReviveButton() {\n\t\tclearInterval(this.reviveTimer)\n\t\tthis.isRangeAction = false\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME || cc.sys.platform === cc.sys.BYTEDANCE_GAME) {\n\t\t\tconsole.log(\"复活\")\n\t\t\tthis._controller.social.onReviveButton(1)\n\t\t} else {\n\t\t\tthis.showReviveSuccess()\n\t\t}\n\t},\n\tshowReviveSuccess() {\n\t\t//console.log('打开复活成功页面')\n\t\tthis.revivePage.getChildByName('askRevive').active = false\n\t\tthis.revivePage.getChildByName('successRevive').active = true\n\t},\n\tonReviveCertainBtn() {\n\t\tthis._controller.pageMgr.removePage(2)\n\t\tthis.revivePage.active = false\n\t\tthis._status = 1\n\t\tthis._score.onRevive()\n\t},\n\tupdate() {\n\t\tif (this.isRangeAction) {\n\t\t\tthis.rangeSprite.fillRange -= 1 / 60\n\t\t}\n\t},\n\tonSkipRevive() {\n\t\tclearInterval(this.reviveTimer)\n\t\tthis._controller.pageMgr.pages[5].active = false\n\t\tthis._score.onGameOver(true)\n\t\tthis.isRangeAction = false\n\t},\n\trestart() {\n\t\tthis._controller.pageMgr.onOpenPage(1)\n\t\tthis.recoveryAllBlocks().then(() => {\n\t\t\tthis.gameStart()\n\t\t})\n\t},\n\t// -----------------道具相关---------------\n\t// 储存用户点击时的方块 用于生成道具\n\tonUserTouched(iid, jid, itemType, color, warning, pos) {\n\t\tthis.target = {\n\t\t\ti: iid,\n\t\t\tj: jid,\n\t\t\tcolor: color,\n\t\t\titemType: itemType,\n\t\t\tx: pos.x,\n\t\t\ty: pos.y,\n\t\t\twarning: warning\n\t\t}\n\t},\n\t// 生成道具 type 1为双倍倍数 2为炸弹 3为加五百\n\tgeneratePropItem(type) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t// 是否做道具生成动画\n\t\t\tthis.map[this.target.i][this.target.j] = this.instantiateBlock(this, {\n\t\t\t\tx: this.target.j,\n\t\t\t\ty: this.target.i,\n\t\t\t\tcolor: this.target.color,\n\t\t\t\twidth: this.blockWidth,\n\t\t\t\tstartTime: null\n\t\t\t}, this.blocksContainer, type)\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve()\n\t\t\t}, 300)\n\t\t})\n\t},\n\tcheckGenerateProp(chain) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.target && this.target.warning) {\n\t\t\t\tthis.generatePropItem(this.target.warning).then(() => {\n\t\t\t\t\tresolve()\n\t\t\t\t\treturn\n\t\t\t\t})\n\t\t\t}\n\t\t\tresolve()\n\t\t})\n\t},\n\tonItem(type, color, pos) {\n\t\tswitch (type) {\n\t\t\tcase 1:\n\t\t\t\t// 分数翻倍 最高八倍\n\t\t\t\tthis._score.tipBox.init(this._score, 1)\n\t\t\t\tthis._score.addMult(color, pos)\n\t\t\t\tthis._controller.musicMgr.onDouble()\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) { //行\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) { //列\n\t\t\t\t\t\tif (this.map[i][j] && this.map[i][j].getComponent('cell')._status == 1) {\n\t\t\t\t\t\t\tlet distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n\t\t\t\t\t\t\tif (distance != 0) {\n\t\t\t\t\t\t\t\tthis.map[i][j].getComponent('cell').surfaceAction(distance)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\t// 炸弹 消除同种颜色的\n\t\t\t\tthis._score.tipBox.init(this._score, 2)\n\t\t\t\tthis.node.runAction(AC.shackAction(0.1, 10))\n\t\t\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME) {\n\t\t\t\t\tthis._controller.social.onShakePhone()\n\t\t\t\t}\n\t\t\t\tthis.isPropChain = true\n\t\t\t\tthis._controller.musicMgr.onBoom()\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) { //行\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) { //列\n\t\t\t\t\t\tif (this.map[i][j] && this.map[i][j].getComponent('cell').color == color && this.map[i][j] && this.map[i][j].getComponent('cell')._status != 2) {\n\t\t\t\t\t\t\tthis.map[i][j].getComponent('cell').onTouched(color, false, true)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.map[i][j].runAction(AC.rockAction(0.2, 10))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 3: //:  加步数\n\t\t\t\tthis._score.tipBox.init(this._score, 4)\n\t\t\t\tthis._controller.musicMgr.onDouble()\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) { //行\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) { //列\n\t\t\t\t\t\tif (this.map[i][j] && this.map[i][j].getComponent('cell')._status == 1) {\n\t\t\t\t\t\t\tlet distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n\t\t\t\t\t\t\tif (distance != 0) {\n\t\t\t\t\t\t\t\tthis.map[i][j].getComponent('cell').surfaceAction(distance)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._score.onStep(3).then()\n\t\t\t\tbreak;\n\t\t\tcase 4: // : 消除全部单身的方块\n\t\t\t\tthis._score.tipBox.init(this._score, 5)\n\t\t\t\tthis.isPropChain = true\n\t\t\t\tthis._controller.musicMgr.onMagic()\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) { //行\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) { //列\n\t\t\t\t\t\tif (this.map[i][j] && this.map[i][j].getComponent('cell').isSingle && this.map[i][j] && this.map[i][j].getComponent('cell')._status != 2) {\n\t\t\t\t\t\t\tlet distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n\t\t\t\t\t\t\tthis.map[i][j].getComponent('cell').onTouched(color, false, true, distance)\n\t\t\t\t\t\t\t// console.log(\"魔法棒触发的点\", i, j, this.map[i][j].getComponent('cell').color, this.map[i][j].getComponent('cell').isSingle)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t},\n\t//--------------------- 预制体实例化---------------------\n\t// 生成对象池\n\tgeneratePool() {\n\t\tthis.blockPool = new cc.NodePool()\n\t\tfor (let i = 0; i < Math.pow(this.rowNum, 2); i++) {\n\t\t\tlet block = cc.instantiate(this.blockPrefab)\n\t\t\tthis.blockPool.put(block)\n\t\t}\n\t},\n\t// 实例化单个方块\n\tinstantiateBlock(self, data, parent, itemType, pos) {\n\t\titemType = itemType ? itemType : 0\n\t\tif (itemType != 0) {\n\t\t\t// console.log(\"道具节点数据\", data, itemType)\n\t\t}\n\t\tlet block = null\n\t\tif (self.blockPool && self.blockPool.size() > 0) {\n\t\t\tblock = self.blockPool.get()\n\t\t} else {\n\t\t\tblock = cc.instantiate(self.blockPrefab)\n\t\t}\n\t\tblock.parent = parent\n\t\tblock.scale = 1\n\t\tblock.x = 0\n\t\tblock.y = 0\n\t\tblock.getComponent('cell').init(self, data, this.blockWidth, itemType, pos)\n\t\treturn block\n\t},\n\t// 回收所有节点\n\trecoveryAllBlocks() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet children = this.blocksContainer.children\n\t\t\tif (children.length != 0) {\n\t\t\t\tlet length = children.length\n\t\t\t\t//   console.log(length)\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tthis.blockPool.put(children[0])\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) {\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) {\n\t\t\t\t\t\tthis.map[i][j] = null\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tresolve('')\n\t\t})\n\t},\n\n});"]}